<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>GTAG Test Rig</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

  <script>
    AFRAME.registerComponent('swing-move', {
      schema: { rig: { type: 'selector' }, speed: { default: 1 } },

      init() {
        this.prev = new THREE.Vector3()
        this.curr = new THREE.Vector3()
        this.ready = false
      },

      tick() {
        const rig = this.data.rig.object3D
        const hand = document.querySelector('#rightHand')

        if (!hand) return
        const obj = hand.object3D

        // Wait until controller has a real position
        if (!this.ready) {
          this.prev.setFromMatrixPosition(obj.matrixWorld)
          this.ready = true
          return
        }

        this.curr.setFromMatrixPosition(obj.matrixWorld)

        const dx = this.curr.x - this.prev.x
        const dz = this.curr.z - this.prev.z

        // Move opposite of hand swing
        rig.position.x -= dx * this.data.speed
        rig.position.z -= dz * this.data.speed

        this.prev.copy(this.curr)
      }
    })
  </script>
</head>

<body>
  <a-scene>

    <a-entity id="rig" position="0 0 0" swing-move="rig:#rig; speed:2">

      <!-- Head -->
      <a-entity camera look-controls position="0 1.6 0"></a-entity>

      <!-- Controllers -->
      <a-entity id="leftHand" tracked-controls="hand: left"></a-entity>
      <a-entity id="rightHand" tracked-controls="hand: right"></a-entity>

    </a-entity>

    <a-plane rotation="-90 0 0" width="100" height="100" color="green"></a-plane>

  </a-scene>
</body>
</html>
